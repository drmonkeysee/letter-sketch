!function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function e(t){return t&&t.__esModule?t.default:t}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,r){return(o=i()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&_setPrototypeOf(i,r.prototype),i}).apply(null,arguments)}function a(t,e,r){return o.apply(null,arguments)}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t){return u(t)}function h(t,e,r){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r||t):i.value}})(t,e,r)}function d(t,e,r){return h(t,e,r)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function v(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),n.forEach((function(e){v(t,e,r[e])}))}return t}function g(t,e){return!e||"object"!=((n=e)&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?r(t):e;var n}function _(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||_(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function w(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(t,e){return t.reduce((function(t,r){var n,i="string"==typeof(n=r)||n instanceof String?r:r.name;return t[i=i.replace(i[0],i[0].toLowerCase())]=e(i,r),t}),{})}var k=b(["onBackgroundColorChanged","onDrawCommitted","onForegroundColorChanged","onGlyphChanged","onTerminalResized","onTerminalResizeReady","onTerminalResizeVerify","onToolChanged"],(function(t,e){return t})),C=function(){"use strict";function t(){n(this,t),this._notifications={}}return l(t,[{key:"register",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;l.subscribe(this)}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}},{key:"subscribe",value:function(t,e){var r=this._notifications[t];r||(this._notifications[t]=r=[]),r.push(e)}},{key:"signal",value:function(t){var e=this._notifications[t.event];if(e){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){(0,o.value)(t)}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}}]),t}(),x={},I=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n=h;return function(i,o){if(n===f)throw new Error("Generator is already running");if(n===y){if("throw"===i)throw o;return R()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=I(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var l=c(t,e,r);if("normal"===l.type){if(n=r.done?y:d,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=y,r.method="throw",r.arg=l.arg)}}}(t,r,a),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h="suspendedStart",d="suspendedYield",f="executing",y="completed",v={};function p(){}function g(){}function _(){}var m={};l(m,o,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(O([])));b&&b!==r&&n.call(b,o)&&(m=b);var k=_.prototype=p.prototype=Object.create(m);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,o,a,s){var l=c(t[i],t,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(l.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}}function I(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,I(t,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=c(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:R}}function R(){return{value:e,done:!0}}return g.prototype=_,l(k,"constructor",_),l(_,"constructor",g),g.displayName=l(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},C(x.prototype),l(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(k),l(k,s,"Generator"),l(k,o,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=O,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}(x);try{regeneratorRuntime=I}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=I:Function("r","regeneratorRuntime = r")(I)}var S={179:10,180:14,191:12,192:3,193:7,194:13,195:11,196:5,197:15,217:6,218:9},T={185:14,186:10,187:12,188:6,200:3,201:9,202:7,203:13,204:11,205:5,206:15},E={179:10,181:14,184:12,190:6,198:11,205:5,207:7,209:13,212:3,213:9,216:15},O={182:14,183:12,186:10,189:6,196:5,199:11,208:7,210:13,211:3,214:9,215:15},R=function(){"use strict";function t(e,r){n(this,t),this.lines=e,this.bestFit=r}return l(t,[{key:"getId",value:function(t){return this.bestFit[t]}},{key:"hasAttractor",value:function(t,e){return Boolean(this.lines[t]&e)}}]),t}(),L=new R(S,[196,196,179,192,196,196,217,193,179,218,179,195,191,194,180,197]),F=new R(T,[205,205,186,200,205,205,188,202,186,201,186,204,187,203,185,206]),G=new R(E,[205,205,179,212,205,205,190,207,179,213,179,198,184,209,181,216]),z=new R(O,[196,196,186,211,196,196,189,208,186,214,186,199,183,210,182,215]),A={NONE:0,RIGHT:1,TOP:2,LEFT:4,BOTTOM:8,complement:function(t){return t>2?t>>2:t<<2},rotate:function(t){switch(t){case A.RIGHT:case A.TOP:case A.LEFT:return t<<1;case A.BOTTOM:return A.RIGHT;default:return t}}};function N(t){return S[t]?L:T[t]?F:E[t]?G:O[t]?z:null}function B(t,e){var r;return Boolean(null===(r=N(t))||void 0===r?void 0:r.hasAttractor(t,e))}function P(t,e,r){var n=N(r),i=null,o=null;switch(e){case A.TOP:case A.BOTTOM:i=G,o=z;break;case A.RIGHT:case A.LEFT:i=z,o=G}if(!i)return null;switch(t){case L:case i:switch(n){case L:case o:return L;case F:case i:return i}break;case F:case o:switch(n){case L:case o:return o;case F:case i:return F}}return null}var j=["␀","☺","☻","♥","♦","♣","♠","•","◘","○","◙","♂","♀","♪","♫","☼","►","◄","↕","‼","¶","§","▬","↨","↑","↓","→","←","∟","↔","▲","▼"," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","⌂","Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","¢","£","¥","₧","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","⌐","¬","½","¼","¡","«","»","░","▒","▓","│","┤","╡","╢","╖","╕","╣","║","╗","╝","╜","╛","┐","└","┴","┬","├","─","┼","╞","╟","╚","╔","╩","╦","╠","═","╬","╧","╨","╤","╥","╙","╘","╒","╓","╫","╪","┘","┌","█","▄","▌","▐","▀","α","ß","Γ","π","Σ","σ","µ","τ","Φ","Θ","Ω","δ","∞","φ","ε","∩","≡","±","≥","≤","⌠","⌡","÷","≈","°","∙","·","√","ⁿ","²","■"," "],M={glyphs:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(j,"t0",1);case 1:case"end":return t.stop()}}),t)})),enumerate:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(j.entries(),"t0",1);case 1:case"end":return t.stop()}}),t)})),glyph:function(t){return j[t]},id:function(t){return j.indexOf(t)},SIGILS:{DEFAULT:65,CLEAR:32,CURSOR:124,TRANSPARENT:255,NEWLINE:"\n"}};var D=function(){var t=[0,128,255],e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,l=!0,u=!1,c=void 0,h=!0,d=!1,f=void 0;try{for(var y,v=t[Symbol.iterator]();!(h=(y=v.next()).done);h=!0){var p=y.value;try{for(var g,_=t[Symbol.iterator]();!(l=(g=_.next()).done);l=!0){var m=g.value;e.push("rgb(".concat(s,", ").concat(p,", ").concat(m,")"))}}catch(t){u=!0,c=t}finally{try{l||null==_.return||_.return()}finally{if(u)throw c}}}}catch(t){d=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(d)throw f}}}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return e}(),H={cssColors:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(D,"t0",1);case 1:case"end":return t.stop()}}),t)})),enumerate:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(D.entries(),"t0",1);case 1:case"end":return t.stop()}}),t)})),cssColor:function(t){return D[t]},id:function(t){return t.startsWith("#")&&(t=function(t){var e,r,n;if(3===t.length){var i;e=(i=t)[0],r=i[1],n=i[2],e+=e,r+=r,n+=n}else{if(6!==t.length)return"";e=t.slice(0,2),r=t.slice(2,4),n=t.slice(4,6)}return"rgb(".concat(parseInt(e,16),", ").concat(parseInt(r,16),", ").concat(parseInt(n,16),")")}(t.substring(1))),D.indexOf(t)},COLORS:{BLACK:0,WHITE:D.length-1}},V=function(){"use strict";function t(e,r,i){n(this,t),this._setFields(e,r,i)}return l(t,[{key:"glyphId",get:function(){return this._glyphId},set:function(t){this._glyphId=null!=t?t:M.SIGILS.CLEAR}},{key:"fgColorId",get:function(){return this._fgColorId},set:function(t){this._fgColorId=null!=t?t:H.COLORS.BLACK}},{key:"bgColorId",get:function(){return this._bgColorId},set:function(t){this._bgColorId=null!=t?t:H.COLORS.WHITE}},{key:"isEmpty",value:function(){return this.glyphId===M.SIGILS.CLEAR}},{key:"equals",value:function(t){return this.glyphId===t.glyphId&&this.fgColorId===t.fgColorId&&this.bgColorId===t.bgColorId}},{key:"update",value:function(t){var e=t.glyphId,r=void 0===e?this.glyphId:e,n=t.fgColorId,i=void 0===n?this.fgColorId:n,o=t.bgColorId,a=void 0===o?this.bgColorId:o;this._setFields(r,i,a)}},{key:"clone",value:function(e){var r=void 0===e?{}:e,n=r.glyphId,i=void 0===n?this.glyphId:n,o=r.fgColorId,a=void 0===o?this.fgColorId:o,s=r.bgColorId;return new t(i,a,void 0===s?this.bgColorId:s)}},{key:"_setFields",value:function(t,e,r){this.glyphId=t,this.fgColorId=e,this.bgColorId=r}}]),t}();function W(t,e,r){return{x:t,y:e,cell:r}}function U(t){return t.x<<16^t.y}var Y=e(x).mark(K);function K(t,r){var n,i,o,a,s,l;return e(x).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.x,i=t.y,o=n-1,s=n+1,l=i+1,!((a=i-1)>=0)){e.next=4;break}return e.next=4,{x:n,y:a,direction:A.TOP};case 4:if(!(s<r.width)){e.next=7;break}return e.next=7,{x:s,y:i,direction:A.RIGHT};case 7:if(!(l<r.height)){e.next=10;break}return e.next=10,{x:n,y:l,direction:A.BOTTOM};case 10:if(!(o>=0)){e.next=13;break}return e.next=13,{x:o,y:i,direction:A.LEFT};case 13:case"end":return e.stop()}}),Y)}function q(t,e,r,n){var i=m(t.y<e.y?[t.y,e.y]:[e.y,t.y]),o=i[0],a=i[1],s=m(t.x<e.x?[t.x,e.x]:[e.x,t.x]),l=s[0];return n(o,s[1],a,l,r)}function J(t,e,r,n,i){for(var o=new nt,a=n;a<=e;++a)o.add(W(a,t,i)),o.add(W(a,r,i));for(var s=t+1;s<r;++s)o.add(W(n,s,i)),o.add(W(e,s,i));return o}function Q(t,e,r,n,i){for(var o=[],a=t;a<=r;++a)for(var s=n;s<=e;++s)o.push(W(s,a,i));return o}function X(t,e,r,n,i,o,a){for(var s=new ot(t,e),l=o;l<=n;++l)l===o?(s.add(W(l,r,a.clone({glyphId:e.getId(A.RIGHT|A.DOWN)}))),s.add(W(l,i,a.clone({glyphId:e.getId(A.TOP|A.RIGHT)})))):l===n?(s.add(W(l,r,a.clone({glyphId:e.getId(A.BOTTOM|A.LEFT)}))),s.add(W(l,i,a.clone({glyphId:e.getId(A.TOP|A.LEFT)})))):(s.add(W(l,r,a.clone({glyphId:e.getId(A.RIGHT|A.LEFT)}))),s.add(W(l,i,a.clone({glyphId:e.getId(A.RIGHT|A.LEFT)}))));for(var u=r+1;u<i;++u)s.add(W(o,u,a.clone({glyphId:e.getId(A.TOP|A.BOTTOM)}))),s.add(W(n,u,a.clone({glyphId:e.getId(A.TOP|A.BOTTOM)})));return s.solve(),s}function Z(t,e,r,n,i){var o=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y),s=new nt;if(o||a)if(o)if(a)!function(t,e,r){var n=Math.pow(t,2),i=Math.pow(e,2),o=2*n,a=2*i,s=t,l=0,u=0,c=i*(1-2*t),h=n,d=a*t,f=0;for(;d>=f;)r(s,l++),f+=o,u+=h,h+=o,2*u+c>0&&(--s,d-=a,u+=c,c+=a);var y=s,v=l;s=0,l=e,u=0,c=i,h=n*(1-2*e),d=0,f=o*e;for(;d<=f;)r(s++,l),d+=a,u+=c,c+=a,2*u+h>0&&(--l,f-=o,u+=h,h+=o);for(;l>=v;)r(s-1,l--);for(;s<=y;)r(s++,l)}(o,a,(function(e,o){return i(e,o,t,r.width,r.height,s,n)}));else for(var l=0;l<=o;++l){var u=t.x+l,c=t.x-l;u<r.width&&s.add(W(u,t.y,n)),c>=0&&s.add(W(c,t.y,n))}else for(var h=0;h<=a;++h){var d=t.y+h,f=t.y-h;d<r.height&&s.add(W(t.x,d,n)),f>=0&&s.add(W(t.x,f,n))}else s.add(W(t.x,t.y,n));return s}function $(t,e,r,n,i,o,a){var s=r.x+t,l=r.x-t,u=r.y+e,c=r.y-e;s<n&&u<i&&o.add(W(s,u,a)),l>=0&&u<i&&o.add(W(l,u,a)),s<n&&c>=0&&o.add(W(s,c,a)),l>=0&&c>=0&&o.add(W(l,c,a))}function tt(t,e,r,n,i,o,a){for(var s=Math.min(r.x+t,n-1),l=Math.max(0,r.x-t),u=Math.min(r.y+e,i-1),c=Math.max(0,r.y-e),h=s;h>=r.x;--h)o.add(W(h,u,a)),o.add(W(h,c,a));for(var d=l;d<r.x;++d)o.add(W(d,u,a)),o.add(W(d,c,a))}var et=Symbol.iterator,rt=function(){"use strict";function t(){n(this,t),this._tiles=[]}return l(t,[{key:"length",get:function(){return this._tiles.length}},{key:"add",value:function(t){this._tiles.push(t)}},{key:et,value:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this._tiles,"t0",1);case 1:case"end":return t.stop()}}),t,this)}))},{key:"_find",value:function(t){return this._findin(t,this._tiles)}},{key:"_findin",value:function(t,e){return e.find((function(e){return e.x===t.x&&e.y===t.y}))}}]),t}(),nt=function(t){"use strict";function e(){var t;return n(this,e),(t=g(this,c(e).call(this)))._points=new Set,t}return y(e,t),l(e,[{key:"add",value:function(t){var e=U(t);this._points.has(e)||this._insert(t,e)}},{key:"_insert",value:function(t,r){d(c(e.prototype),"add",this).call(this,t),this._points.add(r)}}]),e}(rt),it=function(t){"use strict";function e(t,r){var i;return n(this,e),(i=g(this,c(e).call(this))).terminal=t,i.lineSet=r,i}return y(e,t),e}(nt),ot=function(t){"use strict";function e(){return n(this,e),g(this,c(e).apply(this,arguments))}return y(e,t),l(e,[{key:"solve",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this._tiles[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value,a=0,s=this.lineSet,l=!0,u=!1,c=void 0;try{for(var h,d=K(o,this.terminal.dimensions)[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f,y=h.value;a=(f=this._solveNeighborConstraints(y,a,s))[0],s=f[1]}}catch(t){u=!0,c=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw c}}o.cell.glyphId=s.getId(a)}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"_solveNeighborConstraints",value:function(t,e,r){var n,i=this._find(t),o=null!==(n=null==i?void 0:i.cell)&&void 0!==n?n:this.terminal.getCell(t.x,t.y);return B(o.glyphId,A.complement(t.direction))&&(e|=t.direction,i||(r=P(this.lineSet,A.rotate(t.direction),o.glyphId))),[e,r]}}]),e}(it),at=function(t){"use strict";function e(){return n(this,e),g(this,c(e).apply(this,arguments))}return y(e,t),l(e,[{key:"add",value:function(t){t=this._resolveTile(t);var r=[],n=0,i=!0,o=!1,a=void 0;try{for(var s,l=K(t,this.terminal.dimensions)[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;n=this._processNeighbor(u,n,r),t.cell.glyphId=this.lineSet.getId(n)}}catch(t){o=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}var h=!0,f=!1,y=void 0;try{for(var v,p=r[Symbol.iterator]();!(h=(v=p.next()).done);h=!0){var g=v.value;d(c(e.prototype),"add",this).call(this,g)}}catch(t){f=!0,y=t}finally{try{h||null==p.return||p.return()}finally{if(f)throw y}}}},{key:"_resolveTile",value:function(t){var e=U(t);if(this._points.has(e)){var r=this._find(t);r.cell.update({fgColorId:t.cell.fgColorId,bgColorId:t.cell.bgColorId}),t=r}else t.cell=t.cell.clone({glyphId:this.lineSet.getId(A.RIGHT|A.LEFT)}),this._insert(t,e);return t}},{key:"_processNeighbor",value:function(t,e,r){var n,i,o=null!==(n=this._find(t))&&void 0!==n?n:this._findin(t,r),a=null!==(i=null==o?void 0:o.cell)&&void 0!==i?i:this.terminal.getCell(t.x,t.y),s=o?this.lineSet:P(this.lineSet,t.direction,a.glyphId);if(s){if(e|=t.direction,!o){var l=a.clone({glyphId:s.getId(A.RIGHT|A.LEFT)});o=W(t.x,t.y,l),r.push(o)}var u=A.complement(t.direction),c=!0,h=!1,d=void 0;try{for(var f,y=K(o,this.terminal.dimensions)[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){var v=f.value;u=this._processNeighborOfNeighbor(v,u,r)}}catch(t){h=!0,d=t}finally{try{c||null==y.return||y.return()}finally{if(h)throw d}}o.cell.glyphId=s.getId(u)}return e}},{key:"_processNeighborOfNeighbor",value:function(t,e,r){var n,i,o=null!==(n=this._find(t))&&void 0!==n?n:this._findin(t,r);return B((null!==(i=null==o?void 0:o.cell)&&void 0!==i?i:this.terminal.getCell(t.x,t.y)).glyphId,A.complement(t.direction))&&(e|=t.direction),e}}]),e}(it),st=Symbol.iterator,lt=function(t){"use strict";function r(t){var e;return n(this,r),(e=g(this,c(r).call(this)))._fgColor=t.fgColorId,e._bgColor=t.bgColorId,e.cursorOn=new V(M.SIGILS.CURSOR,e._fgColor,e._bgColor),e.cursorOff=new V(M.SIGILS.TRANSPARENT,e._fgColor,e._bgColor),e}return y(r,t),l(r,[{key:"advance",value:function(t,e){var r=new V(e,this._fgColor,this._bgColor);this.add(W(t.x,t.y,r))}},{key:"newline",value:function(t){this.add(W(t.x,t.y,M.SIGILS.NEWLINE))}},{key:"reverse",value:function(){return this._tiles.pop()}},{key:st,value:e(x).mark((function t(){return e(x).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this._tiles.filter((function(t){return t.cell!==M.SIGILS.NEWLINE})),"t0",1);case 1:case"end":return t.stop()}}),t,this)}))}]),r}(rt);function ut(t,e,r,n){return null!=n?n:[W(e.x,e.y,t)]}function ct(t,e,r,n){return(n=null!=n?n:new nt).add(W(r.x,r.y,t)),n}function ht(t,e,r,n,i){var o=N(t.glyphId);return(n=null!=n?n:o?new at(i,o):new nt).add(W(r.x,r.y,t)),n}function dt(t,e,r,n,i){if(n)return n;for(var o=new Set([U(e)]),a=[e],s=[W(e.x,e.y,t)],l=i.getCell(e.x,e.y);a.length>0;){var u=a.shift(),c=!0,h=!1,d=void 0;try{for(var f,y=K(u,i.dimensions)[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){var v=f.value,p=U(v);if(!o.has(p))o.add(p),i.getCell(v.x,v.y).equals(l)&&(s.push(W(v.x,v.y,t)),a.push(v))}}catch(t){h=!0,d=t}finally{try{c||null==y.return||y.return()}finally{if(h)throw d}}}return s}function ft(t,e,r){return q(e,r,t,J)}function yt(t,e,r){return q(e,r,t,Q)}function vt(t,e,r,n,i){var o=N(t.glyphId);return q(e,r,t,o?function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return X.apply(void 0,[i,o].concat(w(e)))}:J)}function pt(t,e,r,n,i){return Z(e,r,i.dimensions,t,$)}function gt(t,e,r,n,i){return Z(e,r,i.dimensions,t,tt)}function _t(t,e,r){return function(t,e,r,n,i){for(var o=Math.abs(r-t),a=-Math.abs(n-e),s=t<r?1:-1,l=e<n?1:-1,u=new nt,c=o+a;u.add(W(t,e,i)),t!==r||e!==n;){var h=2*c;h>=a&&(c+=a,t+=s),h<=o&&(c+=o,e+=l)}return u}(e.x,e.y,r.x,r.y,t)}function mt(t,e,r,n){return null!=n?n:new lt(t)}function wt(t,e,r,n,i){if(n)return n;var o=i.getCell(e.x,e.y),a=[];if(o.equals(t))return a;for(var s=i.dimensions,l=s.width,u=s.height,c=0;c<u;++c)for(var h=0;h<l;++h){i.getCell(h,c).equals(o)&&a.push(W(h,c,t))}return a}function bt(t){return{x:parseInt(t.dataset.x,10),y:parseInt(t.dataset.y,10)}}var kt=function(){"use strict";function t(e,r,i,o){n(this,t),this.onState=e,this.offState=r,this.draw=i,this.restore=o,this._on=!1}return l(t,[{key:"position",get:function(){return this._position}},{key:"set",value:function(t){clearInterval(this._timer),this._start(t)}},{key:"reset",value:function(t){this._on=!1,clearInterval(this._timer),this.restore(this.position),t&&this._start(t)}},{key:"clear",value:function(){clearInterval(this._timer)}},{key:"_start",value:function(t){this._on=!0,this._position=p({},t),this._toggle(),this._timer=setInterval(this._toggle.bind(this),600)}},{key:"_toggle",value:function(){this.draw(this.position.x,this.position.y,this._on?this.onState:this.offState),this._on=!this._on}}]),t}(),Ct=function(){"use strict";function t(e,r,i){n(this,t),this.updateFigure=e,this.sketchpad=r,this.terminal=i,this._started=!1}return l(t,[{key:"handleEvent",value:function(t){var e=t.type.replace(t.type[0],t.type[0].toUpperCase()),r="on".concat(e);return this[r]?this[r](t):null}}]),t}(),xt=function(t){"use strict";function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o;return n(this,e),(o=g(this,c(e).apply(this,r)))._prevDrawTiles=[],o}return y(e,t),l(e,[{key:"_drawFigure",value:function(){var t=new Set,e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this._activeFigure[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,l=s.x,u=s.y,c=s.cell;this.sketchpad.updateAt(l,u,c);var h={x:l,y:u};t.add(U(h)),e.push(h)}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}var d=!0,f=!1,y=void 0;try{for(var v,p=this._prevDrawTiles[Symbol.iterator]();!(d=(v=p.next()).done);d=!0){var g=v.value;if(!t.has(U(g))){var _=g.x,m=g.y,w=this.terminal.getCell(_,m);this.sketchpad.updateAt(_,m,w)}}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}this._prevDrawTiles=e}}]),e}(Ct),It=function(t){"use strict";function e(){return n(this,e),g(this,c(e).apply(this,arguments))}return y(e,t),l(e,[{key:"onMousedown",value:function(t){return this._started=!0,this._start=this._end=bt(t.target),this._activeFigure=this.updateFigure(this._start,this._end,this._activeFigure,this.terminal),this._drawFigure(),null}},{key:"onMouseover",value:function(t){return this._started?(this._end=bt(t.target),this._activeFigure=this.updateFigure(this._start,this._end,this._activeFigure,this.terminal),this._drawFigure(),null):null}},{key:"onMouseup",value:function(t){return this._activeFigure}}]),e}(xt),St=function(t){"use strict";function e(){return n(this,e),g(this,c(e).apply(this,arguments))}return y(e,t),l(e,[{key:"onMousedown",value:function(t){return this._started?this.cleanup():(this._started=!0,this._dimensions=this.terminal.dimensions,this._activeFigure=this.updateFigure(),this._start=this._end=bt(t.target),this._cursor=new kt(this._activeFigure.cursorOn,this._activeFigure.cursorOff,this._drawCursor.bind(this),this._restoreCell.bind(this)),this._cursor.set(this._start),console.log("START CURSOR POS: %o",this._start),null)}},{key:"onKeydown",value:function(t){if(!this._started||t.altKey||t.ctrlKey||t.metaKey)return null;switch(t.preventDefault(),t.key){case"Backspace":this._reverseCharacter();break;case"Enter":this._newline();break;case"Escape":return this.cleanup();case" ":this._advanceCharacter(this._cursor.offState.glyphId);break;default:this._advanceCharacter(M.id(t.key))}return null}},{key:"cleanup",value:function(){return this._started?(this._cursor.reset(),this._activeFigure):null}},{key:"_isValidPosition",get:function(){return this._end.y>=0&&this._end.y<this._dimensions.height}},{key:"_advanceCharacter",value:function(t){!this._isValidPosition||t<0||(this._activeFigure.advance(this._end,t),this._advanceCursor(),this._drawFigure())}},{key:"_advanceCursor",value:function(){var t=this._end,e=t.x,r=t.y;++e>=this._dimensions.width&&(e=0,++r),this._end={x:e,y:r},r<this._dimensions.height?this._cursor.set(this._end):this._cursor.clear(),console.log("NEW CURSOR POS: %o",this._end)}},{key:"_reverseCharacter",value:function(){var t=this._activeFigure.reverse();t&&(this._end={x:t.x,y:t.y},this._cursor.reset(this._end)),console.log("REVERSE CURSOR POS: %o",this._end)}},{key:"_newline",value:function(){this._activeFigure.newline(this._end);var t=this._end.y+1;t<this._dimensions.height&&(this._end={x:this._start.x,y:t},this._cursor.reset(this._end)),console.log("NL CURSOR POS: %o",this._end)}},{key:"_drawCursor",value:function(t,e,r){this.sketchpad.updateAt(t,e,r)}},{key:"_restoreCell",value:function(t){var e=this.terminal.getCell(t.x,t.y);this.sketchpad.updateAt(t.x,t.y,e)}}]),e}(xt),Tt=function(t){"use strict";function e(){return n(this,e),g(this,c(e).apply(this,arguments))}return y(e,t),l(e,[{key:"onMouseup",value:function(t){this._started=!0,t.stopPropagation();var e=bt(t.target);return Number.isNaN(e.x)||Number.isNaN(e.y)||this.sketchpad.commitCellSampling(this.terminal.getCell(e.x,e.y)),this.updateFigure()}}]),e}(Ct),Et=function(){"use strict";function t(e,r,i){n(this,t),this.models=e,this.gestureCls=r,this.figure=i}return l(t,[{key:"forward",value:function(t,e){return this._gesture||(this._gesture=this._createGesture(t)),this._gesture.handleEvent(e)}},{key:"committed",value:function(t){this._gesture=null}},{key:"cleanup",value:function(t){return this.committed(t),null}},{key:"_createGesture",value:function(t){var e=this;return new this.gestureCls((function(t,r,n,i){return e.figure(e.models.lettertype.cell,t,r,n,i)}),t,this.models.terminal)}}]),t}(),Ot=function(t){"use strict";function e(t){return n(this,e),g(this,c(e).call(this,t,St,mt))}return y(e,t),l(e,[{key:"forward",value:function(t,r){var n=d(c(e.prototype),"forward",this).call(this,t,r);return n&&(this._pendingGesture=this._createGesture(t),this._pendingGesture.handleEvent(r)),n}},{key:"committed",value:function(t){this._gesture=this._pendingGesture,this._pendingGesture=null}},{key:"cleanup",value:function(t){var e=this._gesture.cleanup();return this._gesture=this._pendingGesture=null,e}}]),e}(Et),Rt=function(t){"use strict";function e(t){return n(this,e),g(this,c(e).call(this,t,Tt,(function(){return[]})))}return y(e,t),e}(Et),Lt={point:function(t){return new Et(t,It,ut)},brush:function(t){return new Et(t,It,ct)},boxBrush:function(t){return new Et(t,It,ht)},fill:function(t){return new Et(t,It,dt)},rect:function(t){return new Et(t,It,ft)},fillRect:function(t){return new Et(t,It,yt)},boxRect:function(t){return new Et(t,It,vt)},ellipse:function(t){return new Et(t,It,pt)},fillEllipse:function(t){return new Et(t,It,gt)},line:function(t){return new Et(t,It,_t)},text:function(t){return new Ot(t)},swap:function(t){return new Et(t,It,wt)},eyedrop:function(t){return new Rt(t)}},Ft=b(Object.values(Lt),(function(t,e){return t}));function Gt(t){var e=Lt[t.currentTool];if(!e)throw new Error("Unknown tool: ".concat(t.currentTool));return e(t)}function zt(t,e){return p({event:t},e)}var At={commitDraw:function(t,e,r){var n=void 0!==r&&r;return function(){return t.terminal.update(e),zt(k.onDrawCommitted,{figure:e,cleanup:n})}},checkResizeTerminal:function(t,e){return function(){var r=t.terminal.dimensions;return zt(e.columns<r.width||e.rows<r.height?k.onTerminalResizeVerify:k.onTerminalResizeReady,{dims:e})}},commitResizeTerminal:function(t,e){return function(){return console.log("resized terminal: %o",e),t.terminal.resize(e.columns,e.rows),t.lettertype.fontSize=e.fontSize,zt(k.onTerminalResized,{terminal:t.terminal,fontSize:e.fontSize})}},setBackgroundColor:function(t,e){return function(){return t.lettertype.cell.bgColorId=e,zt(k.onBackgroundColorChanged,{colorId:e})}},setForegroundColor:function(t,e){return function(){return t.lettertype.cell.fgColorId=e,zt(k.onForegroundColorChanged,{colorId:e})}},setGlyph:function(t,e){return function(){return t.lettertype.cell.glyphId=e,zt(k.onGlyphChanged,{glyphId:e})}},setTool:function(t,e){return function(){return t.currentTool=e,zt(k.onToolChanged,{tool:Gt(t),name:e})}}},Nt=b(Object.values(At),(function(t,e){return t})),Bt=function(){"use strict";function t(e,r){n(this,t),this.notifier=e,this._bindCommands(r)}return l(t,[{key:"command",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var i=this._commands[t];if(!i)throw new Error("Unknown command: ".concat(t));var o=i.apply(void 0,w(r)),a=o();this.notifier.signal(a)}},{key:"_bindCommands",value:function(t){this._commands=b(Object.values(At),(function(e,r){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[t].concat(w(n)))}}))}}]),t}(),Pt=Math.pow(2,16),jt=function(){"use strict";function t(e,r){n(this,t),this._stride=this._height=0,this.resize(e,r)}return l(t,[{key:"dimensions",get:function(){return{width:this._stride,height:this._height}}},{key:"resize",value:function(t,e){if(t<1||t>Pt||e<1||e>Pt){var r="Terminal dimensions must be in range "+"[".concat(1,", ").concat(Pt,"];")+" got arguments {columns: ".concat(t,", rows: ").concat(e,"}");throw new Error(r)}if(t!==this._stride||e!==this._height){var n=this._newCellGrid(t,e);this._stride=t,this._height=e,this._cells=n}}},{key:"getCell",value:function(t,e){var r=t+e*this._stride;return this._cells[r]}},{key:"updateCell",value:function(t,e,r){this.getCell(t,e).update(r)}},{key:"update",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=a.x,l=a.y,u=a.cell;this.updateCell(s,l,u)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"_newCellGrid",value:function(t,e){for(var r=[],n=Math.trunc((this._stride-t)/2),i=Math.trunc((this._height-e)/2),o=0;o<e;++o)for(var a=0;a<t;++a){var s=a+n,l=o+i,u=this._getResizeAdjustedCell(s,l);r.push(u||new V)}return r}},{key:"_getResizeAdjustedCell",value:function(t,e){return t>=0&&t<this._stride&&e>=0&&e<this._height?this.getCell(t,e):null}}]),t}(),Mt=function(){return{currentTool:Ft.brush,lettertype:{cell:new V(M.SIGILS.DEFAULT),fontSize:24},terminal:new jt(50,20)}},Dt=function t(e,r){"use strict";n(this,t),this.doc=e,this.dispatch=r},Ht=function(t){"use strict";function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o;return n(this,e),(o=g(this,c(e).apply(this,r)))._block=o.doc.getElementById("letter-block"),o}return y(e,t),l(e,[{key:"draw",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=M.enumerate()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=m(i.value),s=a[0],l=a[1],u=this.doc.createElement("span");u.dataset.id=s,u.textContent=l;var c=this.doc.createElement("div");c.appendChild(u),s===t.glyphId&&(c.className="selected"),c.addEventListener("click",this._pickGlyph.bind(this)),this._block.appendChild(c)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"subscribe",value:function(t){t.subscribe(k.onGlyphChanged,this._refreshGlyph.bind(this))}},{key:"_refreshGlyph",value:function(t){var e=t.glyphId,r=!0,n=!1,i=void 0;try{for(var o,a=this._block.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;s.className=s.firstElementChild.dataset.id===e.toString()?"selected":""}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"_pickGlyph",value:function(t){var e=parseInt(t.target.firstElementChild.dataset.id,10);this.dispatch.command(Nt.setGlyph,e)}}]),e}(Dt),Vt=function(t){"use strict";function e(t,r,i,o,a){for(var s=arguments.length,l=new Array(s>5?s-5:0),u=5;u<s;u++)l[u-5]=arguments[u];var h;return n(this,e),(h=g(this,c(e).apply(this,l)))._selection=h.doc.getElementById(t),h.cmd=r,h.refreshEvent=i,h.onSelected=o,h.colorInitializer=a,h}return y(e,t),l(e,[{key:"draw",value:function(t){var e=this;this._setColor(this.colorInitializer(t.colors)),this._selection.addEventListener("click",(function(t){return e.onSelected(e)}))}},{key:"subscribe",value:function(t){t.subscribe(this.refreshEvent,this._refreshColor.bind(this))}},{key:"select",value:function(){this._selection.classList.add("selected")}},{key:"deselect",value:function(){this._selection.classList.remove("selected")}},{key:"pick",value:function(t){this.dispatch.command(this.cmd,t)}},{key:"_refreshColor",value:function(t){this._setColor(t.colorId)}},{key:"_setColor",value:function(t){this._selection.style.backgroundColor=H.cssColor(t)}}]),e}(Dt),Wt=function(t){"use strict";function e(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];var s;n(this,e),(s=g(this,c(e).apply(this,i)))._palette=s.doc.getElementById("palette");var l=s._setSelection.bind(r(s));return s._colorSelections=[a(Vt,["foreground-selection",Nt.setForegroundColor,k.onForegroundColorChanged,l,function(t){return t.fg}].concat(w(i))),a(Vt,["background-selection",Nt.setBackgroundColor,k.onBackgroundColorChanged,l,function(t){return t.bg}].concat(w(i)))],s}return y(e,t),l(e,[{key:"draw",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=H.enumerate()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=m(i.value),s=a[0],l=a[1],u=this.doc.createElement("div");u.className="palette-cell",u.dataset.id=s,u.style.backgroundColor=l,u.addEventListener("click",this._pickColor.bind(this)),this._palette.appendChild(u)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}var c=!0,h=!1,d=void 0;try{for(var f,y=this._colorSelections[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){f.value.draw(t)}}catch(t){h=!0,d=t}finally{try{c||null==y.return||y.return()}finally{if(h)throw d}}this._setSelection(this._colorSelections[0])}},{key:"subscribe",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=this._colorSelections[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.subscribe(t)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"_setSelection",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=this._colorSelections[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.deselect()}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}t.select(),this._currentSelection=t}},{key:"_pickColor",value:function(t){var e=parseInt(t.target.dataset.id,10);this._currentSelection.pick(e)}}]),e}(Dt),Ut=function(t){"use strict";function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o;return n(this,e),(o=g(this,c(e).apply(this,r)))._form=o.doc.getElementById("sketchpad-controls"),o._button=o._form.querySelector("button"),o._inputControls=[o.doc.getElementById("font-size"),o.doc.getElementById("column-count"),o.doc.getElementById("row-count")],o}return y(e,t),l(e,[{key:"fontSize",get:function(){return parseInt(this._inputControls[0].value,10)}},{key:"columns",get:function(){return parseInt(this._inputControls[1].value,10)}},{key:"rows",get:function(){return parseInt(this._inputControls[2].value,10)}},{key:"draw",value:function(t){var e=this,r=t.terminal.dimensions;[t.fontSize,r.width,r.height].forEach((function(t,r){var n=e._inputControls[r];n.dataset.currentValue=n.value=t}));var n=!0,i=!1,o=void 0;try{for(var a,s=this._inputControls[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){a.value.addEventListener("input",this._updateButton.bind(this))}}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}this._form.addEventListener("submit",this._updateSketchpadDims.bind(this))}},{key:"subscribe",value:function(t){t.subscribe(k.onTerminalResizeVerify,this._verifyResize.bind(this)),t.subscribe(k.onTerminalResizeReady,this._commitResize.bind(this))}},{key:"_updateSketchpadDims",value:function(t){t.preventDefault();var e={fontSize:this.fontSize,columns:this.columns,rows:this.rows};this.dispatch.command(Nt.checkResizeTerminal,e)}},{key:"_verifyResize",value:function(t){if(this.doc.defaultView.confirm("Reducing the drawing size may discard portions of your current sketch. Continue?"))this._commitResize(t);else{var e=!0,r=!1,n=void 0;try{for(var i,o=this._inputControls[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.value=a.dataset.currentValue}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this._updateButton()}}},{key:"_commitResize",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=this._inputControls[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.dataset.currentValue=a.value}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}this._updateButton(),this.dispatch.command(Nt.commitResizeTerminal,t.dims)}},{key:"_updateButton",value:function(){this._button.disabled=this._inputControls.every((function(t){return t.value===t.dataset.currentValue}))}}]),e}(Dt),Yt=function(t){"use strict";function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o;return n(this,e),(o=g(this,c(e).apply(this,r)))._controls=a(Ut,w(r)),o._ruler=o.doc.getElementById("glyph-ruler"),o._sketchpad=o.doc.getElementById("sketchpad"),o._grid=[],o._stride=0,o}return y(e,t),l(e,[{key:"draw",value:function(t){this._controls.draw(t),this._tool=t.tool,this._drawSketchpad(t.terminal,t.fontSize),this.doc.addEventListener("mouseup",this._handleGesture.bind(this)),this.doc.addEventListener("keydown",this._handleGesture.bind(this))}},{key:"subscribe",value:function(t){this._controls.subscribe(t),t.subscribe(k.onDrawCommitted,this._committed.bind(this)),t.subscribe(k.onToolChanged,this._updateTool.bind(this)),t.subscribe(k.onTerminalResized,this._resizeSketchpad.bind(this))}},{key:"updateAt",value:function(t,e,r){var n=t+e*this._stride,i=this._grid[n];if(i){var o=i.firstChild;o.textContent=M.glyph(r.glyphId),o.style.color=H.cssColor(r.fgColorId),o.style.backgroundColor=H.cssColor(r.bgColorId)}else console.warn("Invalid grid index %d: (%d, %d)",n,t,e)}},{key:"commitCellSampling",value:function(t){this.dispatch.command(Nt.setForegroundColor,t.fgColorId),this.dispatch.command(Nt.setBackgroundColor,t.bgColorId),this.dispatch.command(Nt.setGlyph,t.glyphId)}},{key:"_drawSketchpad",value:function(t,e){var r=this._measureGlyph(e),n=t.dimensions;this._stride=n.width,console.log("Tilesize: %o",r),console.log("TermSize: %o",n);var i=this._sketchpad.style;i.fontSize="".concat(e,"px"),i.width="".concat(n.width*r.width,"px"),i.height="".concat(n.height*r.height,"px"),i.gridTemplateColumns="repeat(".concat(n.width,", 1fr)");var o="".concat(r.width,"px"),a="".concat(r.height,"px"),s=["mousedown","mouseover","mouseup"];for(this._grid.length=0;this._sketchpad.firstChild;)this._sketchpad.removeChild(this._sketchpad.firstChild);for(var l=0;l<n.height;++l)for(var u=0;u<n.width;++u){var c=this.doc.createElement("div");c.appendChild(this.doc.createElement("span")),c.style.width=o,c.style.height=a,c.dataset.x=u,c.dataset.y=l;var h=!0,d=!1,f=void 0;try{for(var y,v=s[Symbol.iterator]();!(h=(y=v.next()).done);h=!0){var p=y.value;c.addEventListener(p,this._handleGesture.bind(this))}}catch(t){d=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(d)throw f}}this._grid.push(c),this._sketchpad.appendChild(c),this.updateAt(u,l,t.getCell(u,l))}}},{key:"_measureGlyph",value:function(t){var e=this;this._ruler.style.fontSize="".concat(t,"px");var r={minWidth:100,maxWidth:0,minHeight:100,maxHeight:0};r=w(M.glyphs()).reduce((function(t,r){e._ruler.textContent=r;var n=e._ruler.getBoundingClientRect(),i=n.width,o=n.height;return{minWidth:Math.min(t.minWidth,i||t.minWidth),maxWidth:Math.max(t.maxWidth,i),minHeight:Math.min(t.minHeight,o||t.minHeight),maxHeight:Math.max(t.maxHeight,o)}}),r),this._ruler.textContent=M.glyph(M.SIGILS.DEFAULT);var n=this._ruler.getBoundingClientRect(),i=n.width,o=n.height;return console.log("Font dims: %o",r),console.log("Bounding rect: %o",{width:i,height:o}),{width:Math.round(i),height:Math.round(o)}}},{key:"_handleGesture",value:function(t){var e=this._tool.forward(this,t);e&&(this.dispatch.command(Nt.commitDraw,e),console.log("generated figure: %o",e))}},{key:"_committed",value:function(t){t.cleanup||(console.log("commit figure"),this._tool.committed(t))}},{key:"_updateTool",value:function(t){var e=this._tool.cleanup();e&&(this.dispatch.command(Nt.commitDraw,e,!0),console.log("got cleanup figure: %o",e)),this._tool=t.tool}},{key:"_resizeSketchpad",value:function(t){this._drawSketchpad(t.terminal,t.fontSize)}}]),e}(Dt),Kt=function(t){"use strict";function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o;return n(this,e),(o=g(this,c(e).apply(this,r)))._toolSelector=o.doc.getElementById("tool-selections"),o._toolSelections=[],o}return y(e,t),l(e,[{key:"draw",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=Object.values(Ft)[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=this.doc.createElement("input");s.type="radio",s.id="tool-selection-".concat(a),s.name="tool-selection",s.value=a,s.checked=a===t.toolName,s.addEventListener("input",this._pickTool.bind(this));var l=this.doc.createElement("label");l.htmlFor=s.id,l.innerText=a,this._toolSelector.appendChild(s),this._toolSelector.appendChild(l),this._toolSelections.push(s)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"subscribe",value:function(t){t.subscribe(k.onToolChanged,this._refreshTool.bind(this))}},{key:"_pickTool",value:function(t){this.dispatch.command(Nt.setTool,t.target.value)}},{key:"_refreshTool",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=this._toolSelections[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.checked=a.value===t.name}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}}]),e}(Dt),qt=[Wt,Ht,Yt,Kt],Jt=function(){"use strict";function t(e){n(this,t),this.win=e,this._doc=e.document,this._notifier=new C,this._models={}}return l(t,[{key:"initialize",value:function(){this._createModels(),this._wireCommands(),this._createViews(),this._registerViews(),this._drawViews(),console.log("started letter-sketch")}},{key:"_createModels",value:function(){this._models=Mt()}},{key:"_wireCommands",value:function(){this._dispatch=new Bt(this._notifier,this._models)}},{key:"_createViews",value:function(){var t=this;this._views=qt.map((function(e){return new e(t._doc,t._dispatch)}))}},{key:"_registerViews",value:function(){var t;(t=this._notifier).register.apply(t,w(this._views))}},{key:"_drawViews",value:function(){var t=this._initialState(),e=!0,r=!1,n=void 0;try{for(var i,o=this._views[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.draw(t)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"_initialState",value:function(){return{colors:{bg:this._models.lettertype.cell.bgColorId,fg:this._models.lettertype.cell.fgColorId},fontSize:this._models.lettertype.fontSize,glyphId:this._models.lettertype.cell.glyphId,terminal:this._models.terminal,tool:Gt(this._models),toolName:this._models.currentTool}}}]),t}();t.lettersketch={start:function(t){new Jt(t).initialize()}}}();
//# sourceMappingURL=index.5afcfabe.js.map
